<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Kube-Proxy - myprep</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">Overview</li><li class="chapter-item expanded "><a href="../../overview.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../../contributors.html"><strong aria-hidden="true">2.</strong> Contributors</a></li><li class="chapter-item expanded affix "><li class="part-title">Let's get started</li><li class="chapter-item expanded "><a href="../../os/os.html"><strong aria-hidden="true">3.</strong> OPERATING SYSTEM</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../os/kernel/kernel.html"><strong aria-hidden="true">3.1.</strong> Kernel</a></li><li class="chapter-item expanded "><a href="../../os/syscalls/syscalls.html"><strong aria-hidden="true">3.2.</strong> System Calls</a></li><li class="chapter-item expanded "><a href="../../os/program_process/programprocess.html"><strong aria-hidden="true">3.3.</strong> Program vs Process</a></li><li class="chapter-item expanded "><a href="../../os/threads/threads.html"><strong aria-hidden="true">3.4.</strong> Threads</a></li></ol></li><li class="chapter-item expanded "><a href="../../linux/linux.html"><strong aria-hidden="true">4.</strong> Linux</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../linux/booting/booting.html"><strong aria-hidden="true">4.1.</strong> Booting Process</a></li><li class="chapter-item expanded "><a href="../../linux/networking/networking.html"><strong aria-hidden="true">4.2.</strong> Networking</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../linux/networking/osi/osi.html"><strong aria-hidden="true">4.2.1.</strong> OSI Model</a></li><li class="chapter-item expanded "><a href="../../linux/networking/dns/dns.html"><strong aria-hidden="true">4.2.2.</strong> DNS</a></li><li class="chapter-item expanded "><a href="../../linux/networking/udp/udp.html"><strong aria-hidden="true">4.2.3.</strong> UDP</a></li><li class="chapter-item expanded "><a href="../../linux/networking/tcp/tcp.html"><strong aria-hidden="true">4.2.4.</strong> TCP</a></li><li class="chapter-item expanded "><a href="../../linux/networking/http/http.html"><strong aria-hidden="true">4.2.5.</strong> HTTP(TLS,SSL,HTTPS)</a></li><li class="chapter-item expanded "><a href="../../linux/networking/ip/ip.html"><strong aria-hidden="true">4.2.6.</strong> IPv4 vs IPv6</a></li><li class="chapter-item expanded "><a href="../../linux/networking/icmp/icmp.html"><strong aria-hidden="true">4.2.7.</strong> ICMP</a></li><li class="chapter-item expanded "><a href="../../linux/networking/troubleshooting/troubleshooting.html"><strong aria-hidden="true">4.2.8.</strong> Troubleshooting</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../linux/networking/troubleshooting/ping/ping.html"><strong aria-hidden="true">4.2.8.1.</strong> ping</a></li><li class="chapter-item expanded "><a href="../../linux/networking/troubleshooting/traceroute/traceroute.html"><strong aria-hidden="true">4.2.8.2.</strong> traceroute</a></li></ol></li></ol></li></ol></li><li class="chapter-item expanded "><li class="part-title">Intermediate</li><li class="chapter-item expanded "><a href="../../sre/sre.html"><strong aria-hidden="true">5.</strong> SRE</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../sre/tools/tools.html"><strong aria-hidden="true">5.1.</strong> Tools</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../sre/tools/virtualization/virtualization.html"><strong aria-hidden="true">5.1.1.</strong> Virtualization</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../kubernetes/k8s.html"><strong aria-hidden="true">6.</strong> Kubernetesüï∏Ô∏è</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../kubernetes/interviews/architecture.html"><strong aria-hidden="true">6.1.</strong> Architecture</a></li><li class="chapter-item expanded "><a href="../../kubernetes/interviews/kube-proxy.html" class="active"><strong aria-hidden="true">6.2.</strong> Kube-Proxy</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../kubernetes/interviews/service-coms.html"><strong aria-hidden="true">6.2.1.</strong> Service - Service Communication</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../CICD/CICD.html"><strong aria-hidden="true">7.</strong> TEST</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">myprep</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/ramdevcm/mypreps" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="kube-proxy-in-kubernetes"><a class="header" href="#kube-proxy-in-kubernetes">kube-proxy in Kubernetes</a></h1>
<h3 id="what-is-kube-proxy"><a class="header" href="#what-is-kube-proxy">What is <strong>kube-proxy</strong>?</a></h3>
<p><code>kube-proxy</code> is a network proxy that runs on each worker node in a Kubernetes cluster. Its primary function is to maintain network rules that allow Pods to communicate with each other and with external clients. It is responsible for ensuring that the network traffic gets routed correctly, based on the Kubernetes Service resources, to the appropriate Pods.</p>
<h4 id="key-responsibilities-of-kube-proxy"><a class="header" href="#key-responsibilities-of-kube-proxy">Key Responsibilities of kube-proxy:</a></h4>
<ol>
<li>
<p><strong>Service Discovery and Load Balancing</strong>: </p>
<ul>
<li><code>kube-proxy</code> watches for changes to Services and Endpoints in the Kubernetes API server and updates iptables or IPVS rules accordingly.</li>
<li>It helps in balancing traffic across Pods within a Service, distributing requests evenly.</li>
</ul>
</li>
<li>
<p><strong>Network Rules Configuration</strong>:</p>
<ul>
<li>It configures the network rules on each node. These rules are set using either <strong>iptables</strong> (default mode) or <strong>IPVS</strong> (optional mode), which are responsible for forwarding traffic to the correct backend Pods based on Service IPs.</li>
</ul>
</li>
<li>
<p><strong>Proxy Modes</strong>:</p>
<ul>
<li><strong>userspace</strong>: The userspace mode is very old, slow, and definitely not recommended!</li>
<li><strong>iptables Mode</strong>: Uses iptables to manage network traffic. It is simple and effective for most use cases.
<ul>
<li>complexity: O(n)</li>
</ul>
</li>
<li><strong>IPVS Mode</strong>: A more advanced and efficient method, providing higher performance and more complex load balancing options, based on IP Virtual Server (IPVS).
<ul>
<li>complexity: O(1)</li>
</ul>
</li>
<li><a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kube-proxy/">Documentation:</a></li>
</ul>
<pre><code>--proxy-mode ProxyMode
    Which proxy mode to use: on Linux this can be 'iptables' (default) or 'ipvs'. 
    On Windows the only supported value is 'kernelspace'.
    This parameter is ignored if a config file is specified by --config. ```

</code></pre>
</li>
<li>
<p><strong>Handling External Access</strong>:</p>
<ul>
<li><code>kube-proxy</code> helps in configuring rules for exposing services externally using LoadBalancer or NodePort services, facilitating communication outside the cluster.</li>
</ul>
</li>
</ol>
<hr />
<h2 id="scenario-based-interview-questions-around-kube-proxy"><a class="header" href="#scenario-based-interview-questions-around-kube-proxy">Scenario-Based Interview Questions Around kube-proxy</a></h2>
<h3 id="1-scenario-you-notice-that-a-service-is-not-accessible-externally-what-could-be-the-issue-with-kube-proxy"><a class="header" href="#1-scenario-you-notice-that-a-service-is-not-accessible-externally-what-could-be-the-issue-with-kube-proxy">1. <strong>Scenario: You notice that a Service is not accessible externally. What could be the issue with kube-proxy?</strong></a></h3>
<ul>
<li><strong>Answer:</strong> There could be multiple issues, including:
<ul>
<li>The <code>kube-proxy</code> might not be running on the worker node.</li>
<li>Incorrect iptables or IPVS rules are preventing traffic from being routed properly.</li>
<li>The Service type could be misconfigured (e.g., ClusterIP instead of NodePort or LoadBalancer).</li>
<li>Network policies or firewalls might be blocking access to the service.</li>
</ul>
</li>
</ul>
<h3 id="2-scenario-youve-noticed-a-performance-degradation-in-your-kubernetes-cluster-after-investigation-you-suspect-kube-proxy-might-be-the-bottleneck-how-would-you-troubleshoot-this"><a class="header" href="#2-scenario-youve-noticed-a-performance-degradation-in-your-kubernetes-cluster-after-investigation-you-suspect-kube-proxy-might-be-the-bottleneck-how-would-you-troubleshoot-this">2. <strong>Scenario: You've noticed a performance degradation in your Kubernetes cluster. After investigation, you suspect kube-proxy might be the bottleneck. How would you troubleshoot this?</strong></a></h3>
<ul>
<li><strong>Answer:</strong> 
<ul>
<li>First, check which mode <code>kube-proxy</code> is running in (iptables vs IPVS). IPVS is more performant, and switching to it might resolve the issue.</li>
<li>Check <code>kube-proxy</code> logs for errors or warnings that could provide more context.</li>
<li>Review the network rules generated by <code>kube-proxy</code> (iptables or IPVS) to ensure they are correct and optimized.</li>
<li>Use <code>kubectl describe</code> to check if there are any issues with Services or Endpoints.</li>
<li>Investigate the overall load on the node and whether <code>kube-proxy</code> is resource-constrained (CPU or memory usage).</li>
</ul>
</li>
</ul>
<h3 id="3-scenario-you-have-a-kubernetes-cluster-with-a-high-volume-of-traffic-the-kube-proxy-is-in-iptables-mode-is-there-a-performance-consideration-and-what-would-you-do"><a class="header" href="#3-scenario-you-have-a-kubernetes-cluster-with-a-high-volume-of-traffic-the-kube-proxy-is-in-iptables-mode-is-there-a-performance-consideration-and-what-would-you-do">3. <strong>Scenario: You have a Kubernetes cluster with a high volume of traffic. The kube-proxy is in iptables mode. Is there a performance consideration, and what would you do?</strong></a></h3>
<ul>
<li><strong>Answer:</strong> 
<ul>
<li>Yes, <code>iptables</code> can become a performance bottleneck under high traffic conditions due to the way rules are processed in the kernel.</li>
<li>Switching to <strong>IPVS mode</strong> might help since it is more efficient for large-scale traffic and offers better load balancing performance.</li>
<li>You can switch kube-proxy to use IPVS by modifying the configuration or flags of the <code>kube-proxy</code> deployment.
<ul>
<li>--proxy-mode</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="4-scenario-youre-running-a-service-with-multiple-pods-but-traffic-is-only-being-sent-to-one-pod-even-though-there-are-multiple-healthy-pods-how-would-you-investigate-the-issue"><a class="header" href="#4-scenario-youre-running-a-service-with-multiple-pods-but-traffic-is-only-being-sent-to-one-pod-even-though-there-are-multiple-healthy-pods-how-would-you-investigate-the-issue">4. <strong>Scenario: You're running a Service with multiple Pods, but traffic is only being sent to one Pod, even though there are multiple healthy Pods. How would you investigate the issue?</strong></a></h3>
<ul>
<li><strong>Answer:</strong> 
<ul>
<li>First, check if the <code>kube-proxy</code> is working correctly by running <code>kubectl get svc</code> and examining the endpoints for the Service.</li>
<li>Ensure that the iptables or IPVS rules are being set up correctly to route traffic across all Pods in the Service.</li>
<li>You can check the load balancing behavior of <code>kube-proxy</code> by using the <code>kubectl describe</code> command on the service and ensuring the endpoints are correctly linked.</li>
<li>Check the Pods themselves for any issues like resource constraints or failing readiness checks that might prevent traffic distribution.</li>
</ul>
</li>
</ul>
<h3 id="5-scenario-after-a-rolling-update-of-your-application-traffic-is-not-reaching-the-new-pods-what-could-kube-proxy-be-doing-wrong"><a class="header" href="#5-scenario-after-a-rolling-update-of-your-application-traffic-is-not-reaching-the-new-pods-what-could-kube-proxy-be-doing-wrong">5. <strong>Scenario: After a rolling update of your application, traffic is not reaching the new Pods. What could kube-proxy be doing wrong?</strong></a></h3>
<ul>
<li><strong>Answer:</strong>
<ul>
<li><code>kube-proxy</code> might not have updated the routing rules correctly after the new Pods were created. Ensure that <code>kube-proxy</code> is aware of the changes in endpoints and the new Pods.</li>
<li>It could also be a problem with the endpoints not being registered correctly or stale endpoints being retained in the <code>kube-proxy</code> rules.</li>
<li>Check the health of the <code>kube-proxy</code> pod and verify that it is running the latest configuration.</li>
<li>You can manually flush the iptables or IPVS rules to trigger a refresh or restart the <code>kube-proxy</code>.</li>
</ul>
</li>
</ul>
<h3 id="6-scenario-you-want-to-expose-a-service-externally-using-nodeport-but-traffic-isnt-routing-as-expected-how-do-you-troubleshoot-this"><a class="header" href="#6-scenario-you-want-to-expose-a-service-externally-using-nodeport-but-traffic-isnt-routing-as-expected-how-do-you-troubleshoot-this">6. <strong>Scenario: You want to expose a Service externally using NodePort, but traffic isn't routing as expected. How do you troubleshoot this?</strong></a></h3>
<ul>
<li><strong>Answer:</strong>
<ul>
<li>Check the <code>kube-proxy</code> logs for any errors related to port forwarding or NodePort configuration.</li>
<li>Make sure the correct NodePort range is configured in the Kubernetes setup.</li>
<li>Verify that the NodePort service is correctly defined in the Service configuration, and that the firewall or cloud provider settings are allowing traffic to the specified NodePort.</li>
<li>Confirm that the worker nodes are accessible externally and the correct port is open.</li>
</ul>
</li>
</ul>
<h3 id="7-scenario-you-are-using-kube-proxy-with-ipvs-mode-but-you-need-to-troubleshoot-a-specific-service-not-routing-traffic-what-steps-would-you-take"><a class="header" href="#7-scenario-you-are-using-kube-proxy-with-ipvs-mode-but-you-need-to-troubleshoot-a-specific-service-not-routing-traffic-what-steps-would-you-take">7. <strong>Scenario: You are using <code>kube-proxy</code> with IPVS mode, but you need to troubleshoot a specific Service not routing traffic. What steps would you take?</strong></a></h3>
<ul>
<li><strong>Answer:</strong>
<ul>
<li>First, check the IPVS rules using the <code>ipvsadm</code> command to inspect the routing table.</li>
<li>Verify that the IPVS mode is correctly set by checking the <code>kube-proxy</code> logs.</li>
<li>Use <code>kubectl get endpoints</code> to verify that the Service has the correct endpoints and is not missing any Pods.</li>
<li>Check if there are any network policies or firewall rules blocking traffic to the Service.</li>
<li>Ensure that the health checks are correctly configured, and the Pods are marked as healthy.</li>
</ul>
</li>
</ul>
<hr />

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../kubernetes/interviews/architecture.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../kubernetes/interviews/service-coms.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../kubernetes/interviews/architecture.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../kubernetes/interviews/service-coms.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
